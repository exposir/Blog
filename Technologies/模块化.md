# 模块化

很长一段时间，JavaScript 都没有语言级（language-level）的模块语法。这不是一个问题，因为最初的脚本又小又简单，所以没必要将其模块化。

但是最终脚本变得越来越复杂，因此社区发明了许多种方法来将代码组织到模块中，使用特殊的库按需加载模块。

- AMD —— 最古老的模块系统之一，最初由 require.js 库实现。
- CommonJS —— 为 Node.js 服务器创建的模块系统。
- UMD —— 另外一个模块系统，建议作为通用的模块系统，它与 AMD 和 CommonJS 都兼容。

## 什么是模块？

一个模块（module）就是一个文件。一个脚本就是一个模块。就这么简单

- export 关键字标记了可以从当前模块外部访问的变量和函数。
- import 关键字允许从其他模块导入功能。

```js
//say.js
function sayHi(user) {
  alert(`Hello, ${user}!`);
}

function sayBye(user) {
  alert(`Bye, ${user}!`);
}

export { sayHi, sayBye }; // 导出变量列表
```

```js
//main.js
import { sayHi, sayBye } from "./say.js";

sayHi("John"); // Hello, John!
sayBye("John"); // Bye, John!
```

```js
//main.js
import * as say from "./say.js";

say.sayHi("John");
say.sayBye("John");
```

## Export default

在实际中，主要有两种模块。

- 包含库或函数包的模块，像上面的 say.js。
- 声明单个实体的模块，例如模块 user.js 仅导出 class User。

大部分情况下，开发者倾向于使用第二种方式，以便每个“东西”都存在于它自己的模块中。

当然，这需要大量文件，因为每个东西都需要自己的模块，但这根本不是问题。实际上，如果文件具有良好的命名，并且文件夹结构得当，那么代码导航（navigation）会变得更容易。

模块提供了一个特殊的默认导出 export default 语法，以使“一个模块只做一件事”的方式看起来更好。

将 export default 放在要导出的实体前：

```js
// 📁 user.js
export default class User {
  // 只需要添加 "default" 即可
  constructor(name) {
    this.name = name;
  }
}
```

每个文件可能只有一个 export default：

……然后将其导入而不需要花括号：

```js
//mai.js
// 📁 main.js
import User from "./user.js"; // 不需要花括号 {User}，只需要写成 User 即可

new User("John");
```

- 命名导出： `export class User {...}` `import {User} from ...`
- 默认导出：`export default class User {...}` ` import User from ...`

## 默认导出和命名导出混合

```js
// 📁 user.js
export default class User {
  constructor(name) {
    this.name = name;
  }
}

export function sayHi(user) {
  alert(`Hello, ${user}!`);
}
```

```js
// 📁 main.js
import { default as User, sayHi } from "./user.js";

new User("John");
```

```js
// 📁 main.js
import * as user from "./user.js";

let User = user.default; // 默认的导出
new User("John");
```

## 动态导入

### 命名倒入

```js
// 📁 say.js
export function hi() {
  alert(`Hello`);
}

export function bye() {
  alert(`Bye`);
}
```

```js
let { hi, bye } = await import("./say.js");

hi();
bye();
```

### 动态导入

```js
// 📁 say.js
export default function () {
  alert("Module loaded (export default)!");
}
```

……那么，为了访问它，我们可以使用模块对象的 default 属性：

```js
let obj = await import("./say.js");
let say = obj.default;
// or, in one line: let {default: say} = await import('./say.js');

say();
```

<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深入浅出 webpack | 孟世博</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="/assets/js/tj.js"></script>
    <meta name="description" content="孟世博的博客">
    
    <link rel="preload" href="/assets/css/0.styles.6a27c2ff.css" as="style"><link rel="preload" href="/assets/js/app.dae46446.js" as="script"><link rel="preload" href="/assets/js/2.8d9d2f5c.js" as="script"><link rel="preload" href="/assets/js/37.8be78373.js" as="script"><link rel="preload" href="/assets/js/3.3fcef884.js" as="script"><link rel="prefetch" href="/assets/js/10.dcce6d21.js"><link rel="prefetch" href="/assets/js/11.caf8561c.js"><link rel="prefetch" href="/assets/js/12.000931d7.js"><link rel="prefetch" href="/assets/js/13.eb982535.js"><link rel="prefetch" href="/assets/js/14.b83f8c0f.js"><link rel="prefetch" href="/assets/js/15.c211495f.js"><link rel="prefetch" href="/assets/js/16.70af5edf.js"><link rel="prefetch" href="/assets/js/17.c3f8b0c6.js"><link rel="prefetch" href="/assets/js/18.31c74969.js"><link rel="prefetch" href="/assets/js/19.1f03f2cb.js"><link rel="prefetch" href="/assets/js/20.c1ba9467.js"><link rel="prefetch" href="/assets/js/21.91a00a10.js"><link rel="prefetch" href="/assets/js/22.8d1c8816.js"><link rel="prefetch" href="/assets/js/23.a862aae2.js"><link rel="prefetch" href="/assets/js/24.1bd089ec.js"><link rel="prefetch" href="/assets/js/25.6c3ae668.js"><link rel="prefetch" href="/assets/js/26.3fe67e0b.js"><link rel="prefetch" href="/assets/js/27.d4625062.js"><link rel="prefetch" href="/assets/js/28.13abcf99.js"><link rel="prefetch" href="/assets/js/29.b72ba134.js"><link rel="prefetch" href="/assets/js/30.6c947341.js"><link rel="prefetch" href="/assets/js/31.7a1cedd5.js"><link rel="prefetch" href="/assets/js/32.6a98081f.js"><link rel="prefetch" href="/assets/js/33.83295082.js"><link rel="prefetch" href="/assets/js/34.ac3e0da1.js"><link rel="prefetch" href="/assets/js/35.087d7239.js"><link rel="prefetch" href="/assets/js/36.8ed1fef8.js"><link rel="prefetch" href="/assets/js/38.0c06daf4.js"><link rel="prefetch" href="/assets/js/39.f895d643.js"><link rel="prefetch" href="/assets/js/4.d5d07293.js"><link rel="prefetch" href="/assets/js/40.9bb62a2a.js"><link rel="prefetch" href="/assets/js/41.2a231577.js"><link rel="prefetch" href="/assets/js/42.40ffa522.js"><link rel="prefetch" href="/assets/js/43.a27a57d6.js"><link rel="prefetch" href="/assets/js/5.fa6403e8.js"><link rel="prefetch" href="/assets/js/6.5e7a8206.js"><link rel="prefetch" href="/assets/js/7.fa61ee83.js"><link rel="prefetch" href="/assets/js/8.5be90e58.js"><link rel="prefetch" href="/assets/js/9.bf0b67e4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6a27c2ff.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">孟世博</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/exposir/personal-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/exposir/personal-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Enjoy Life</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Pin</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Post</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/post/重学 Javascript（一）.html" class="sidebar-link">重学 Javascript（一）</a></li><li><a href="/post/webpack.html" aria-current="page" class="active sidebar-link">webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/post/webpack.html#为什么要构建工具" class="sidebar-link">为什么要构建工具？</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#前端构建演变" class="sidebar-link">前端构建演变</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#为什么选择-webpack" class="sidebar-link">为什么选择 webpack</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#wepack-配置" class="sidebar-link">wepack 配置</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#output" class="sidebar-link">Output</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#plugins" class="sidebar-link">Plugins</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#mode" class="sidebar-link">Mode</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#资源解析-解析-less、css" class="sidebar-link">资源解析：解析 LESS、CSS</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#资源解析-解析图片-、字体" class="sidebar-link">资源解析：解析图片 、字体</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#webpack-中的文件监听" class="sidebar-link">webpack 中的文件监听</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#热更新-webpack-dev-server" class="sidebar-link">热更新：webpack-dev-server</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#热更新-webpack-dev-middleware" class="sidebar-link">热更新：webpack-dev-middleware</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#热更新原理分析" class="sidebar-link">热更新原理分析</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#自动清理构建目录" class="sidebar-link">自动清理构建目录</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#资源内联" class="sidebar-link">资源内联</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#多页面打包" class="sidebar-link">多页面打包</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#提取页面公共资源" class="sidebar-link">提取页面公共资源</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#tree-shaking-摇树优化" class="sidebar-link">tree shaking （摇树优化）</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#scopehoisting" class="sidebar-link">ScopeHoisting</a></li><li class="sidebar-sub-header"><a href="/post/webpack.html#代码分割和动态-import" class="sidebar-link">代码分割和动态 import</a></li></ul></li><li><a href="/post/git 提交指北.html" class="sidebar-link">git 提交指北</a></li><li><a href="/post/《When to pick Gatsby, Next.Js or Create React App》翻译.html" class="sidebar-link">《When to pick Gatsby, Next.Js or Create React App》翻译</a></li><li><a href="/post/学习之路.html" class="sidebar-link">学习之路</a></li><li><a href="/post/有关 CDN 的几个问题.html" class="sidebar-link">有关 CDN 的几个问题</a></li><li><a href="/post/前端全链路性能优化.html" class="sidebar-link">前端全链路性能优化</a></li><li><a href="/post/缓存那些事.html" class="sidebar-link">缓存那些事</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Note</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Else</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="深入浅出-webpack"><a href="#深入浅出-webpack" class="header-anchor">#</a> 深入浅出 webpack</h1> <h2 id="为什么要构建工具"><a href="#为什么要构建工具" class="header-anchor">#</a> 为什么要构建工具？</h2> <ul><li>转换 ES6</li> <li>转换 JSX</li> <li>CSS 前缀补全/预处理器（LESS、SASS）</li> <li>压缩混淆</li> <li>图片压缩</li></ul> <h2 id="前端构建演变"><a href="#前端构建演变" class="header-anchor">#</a> 前端构建演变</h2> <ul><li><p>grunt
grunt 会将整个构建过程分成一个一个任务，每一个任务去做一件事情。比如在 grunt 里面它会将一个打包过程分为解析 HTMl、解析 CSS、解析 js、代码压缩等任务，会将任务结果存在本地磁盘里，所以打包速度较慢。</p></li> <li><p>gulp
gulp 和 grunt 类似，也是一个文件打包器。gulp 有一个文件流的概念，把每一步构建的结果存放在内存里，下一个步骤是可以直接使用上个步骤的内存的，会加快打包的速度</p></li> <li><p>webpack</p></li> <li><p>rollup</p></li> <li><p>parcel</p></li></ul> <h2 id="为什么选择-webpack"><a href="#为什么选择-webpack" class="header-anchor">#</a> 为什么选择 webpack</h2> <p><img src="https://user-images.githubusercontent.com/33340988/110231043-482dbb80-7f50-11eb-9f19-f0ae5e54ba04.png" alt="image"></p> <ul><li>社区生态丰富</li> <li>配置灵活、插件化扩展</li> <li>官方更新迭代速度快</li></ul> <h2 id="wepack-配置"><a href="#wepack-配置" class="header-anchor">#</a> wepack 配置</h2> <p><img src="https://user-images.githubusercontent.com/33340988/110231046-4fed6000-7f50-11eb-843d-1a4e4d30c39d.png" alt="image"></p> <p>npm init -y</p> <ul><li>npm install webpack webpack-cli —save-dev</li></ul> <p>命令解析: package.json 中使用的命令,比如 webpack,会从 node_modules/.bin/目录下找到对应的命令</p> <p>Enty</p> <ul><li><p>Entry 用来指定 webpack 的打包入口</p></li> <li><p>单入口
entry 是一个字符串</p></li> <li><p>多入口（多页应用）
entry 是一个对象</p></li></ul> <h2 id="output"><a href="#output" class="header-anchor">#</a> Output</h2> <ul><li><p>Output 用来告诉 webapck 如何将变以后的文件输出到磁盘</p></li> <li><p>多入口配置
通过占位符确保文件名称的统一</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">'[name].js'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span>__dirname <span class="token operator">+</span> <span class="token string">'/dist'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Loaders</p> <ul><li>webpack 开箱即用只支持 js 和 JSON 两种文件类型，通过 Loaders 去支持其他文件类型并且把它们转化成有效的模块，并且可以添加到依赖图中。</li> <li>本身是一个函数，接受源文件作为参数，返回转换的结果。</li></ul> <h3 id="常见的-loaders"><a href="#常见的-loaders" class="header-anchor">#</a> 常见的 Loaders</h3> <ul><li>babel-loader 转换 ES6、ES7 等 JS 因特性的语法</li> <li>css_loader 支持.css 文件的加载和解析</li> <li>less-loader 将 less 文件转换成 css</li> <li>ts-loader 将 TS 转换成 JS</li> <li>file-loader 进行图片、字体等的打包</li> <li>raw-loader 将文件以字符串的形式导入</li> <li>thread-loader 多进程打包 JS 和 CSS</li></ul> <h3 id="loaders-的用法"><a href="#loaders-的用法" class="header-anchor">#</a> Loaders 的用法</h3> <ul><li>test 指定匹配规则</li> <li>use 指定使用的 Loader 名称</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.txt$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token literal-property property">use</span><span class="token operator">:</span>'raw<span class="token operator">-</span>loader<span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="plugins"><a href="#plugins" class="header-anchor">#</a> Plugins</h2> <ul><li>插件作用于 bundle 文件的优化，资源管理和环境变量注入</li> <li>作用于整个构建过程</li></ul> <h3 id="常见的-plugins"><a href="#常见的-plugins" class="header-anchor">#</a> 常见的 Plugins</h3> <ul><li>CommonsChunkPlugin 将 chunks 相同的模块代码提取成公共 js</li> <li>CleanWebpackPlugin 清理构建目录</li> <li>ExtractTextWebpackPlugin 将 CSS 从 bundle 文件里提取成一个独立的 CSS 文件</li> <li>CopyWebpackPlugin 将文件或者文件夹拷贝到构建的输出目录</li> <li>HtmlWebpackPlugin 创建 html 文件去承载输出的 bundle</li> <li>UglifyjsWebpackPlugin 压缩 JS</li> <li>ZipWebpackPlugin 将打包出的资源生成一个 zip 包</li></ul> <h3 id="plugins-的用法"><a href="#plugins-的用法" class="header-anchor">#</a> Plugins 的用法</h3> <ul><li>插件放入 plugins 数组里</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.html&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="mode"><a href="#mode" class="header-anchor">#</a> Mode</h2> <ul><li>Mode 用来指定当前的构建环境是： production、development 还是 none</li> <li>设置 mode 可以用 webpack 内置的函数，默认值为 production</li></ul> <p><img src="https://user-images.githubusercontent.com/33340988/110231055-62679980-7f50-11eb-8061-6fbe4e93f0dd.png" alt="image"></p> <p>资源解析： 解析 ES6</p> <ul><li><p>npm i @babel/core @babel/preset-env babel-loader -D</p></li> <li><p>使用 babel-loader</p></li> <li><p>babel 的配置文件是： .babelrc /babel.config.js(vue)</p></li> <li><p>webpack.config.js</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token string">&quot;bable-loader&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>babelrc</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
 <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token string">&quot;@babel/preset-env&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="资源解析-解析-less、css"><a href="#资源解析-解析-less、css" class="header-anchor">#</a> 资源解析：解析 LESS、CSS</h2> <ul><li><p>css-loader 用于加载 .css 文件，并且转换成 commonjs 对象</p></li> <li><p>style-loader 将样式通过 <code>&lt;style&gt;</code> 标签插入到 head 中</p></li> <li><p>loader 是链式吊用，执行顺序是从右向左</p></li> <li><p>webpack.config.js</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
    <span class="token string">'less-loader'</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="资源解析-解析图片-、字体"><a href="#资源解析-解析图片-、字体" class="header-anchor">#</a> 资源解析：解析图片 、字体</h2> <ul><li>file-loader</li> <li>url-loader 小资源可以自动转换成 base64</li></ul> <h2 id="webpack-中的文件监听"><a href="#webpack-中的文件监听" class="header-anchor">#</a> webpack 中的文件监听</h2> <ul><li>文件监听是在发现源码发生变化时，自动重新构建出新的输出文件</li></ul> <p>webpack 开启监听模式，有两种方式：</p> <ol><li><p>启动 webapck 命令时，带上 —watch 参数 <code>”watch”:”webpack —watch”</code>
唯一缺陷：每次需要手动刷新浏览器</p></li> <li><p>在配置 webpack.config.js 中设置 watch:true</p></li></ol> <h3 id="文件监听原理分析"><a href="#文件监听原理分析" class="header-anchor">#</a> 文件监听原理分析</h3> <ul><li>轮询判断文件的最后编辑时间是否变化</li> <li>某个文件发生变化，并不会立即告诉监听者，而是先缓存起来，等 aggregateTImeout</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">watchOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">ingored</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//提高性能</span>
    <span class="token literal-property property">aggregateTimeout</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token comment">//监听变化后300ms去执行</span>
    <span class="token literal-property property">poll</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">//每秒问1000次文件是否有变化</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="热更新-webpack-dev-server"><a href="#热更新-webpack-dev-server" class="header-anchor">#</a> 热更新：webpack-dev-server</h2> <ul><li>WDS 不刷新浏览器</li> <li>WDS 不输出文件，而是放在内存中</li></ul> <h3 id="手动引入插件"><a href="#手动引入插件" class="header-anchor">#</a> 手动引入插件</h3> <ul><li>使用 HotModuleReplacementPlugin 插件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span><span class="token string">&quot;webapck-dev-server --open&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>webpack.config.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webapck<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token literal-property property">devServer</span><span class="token operator">:</span><span class="token punctuation">{</span>
 <span class="token literal-property property">contentBase</span><span class="token operator">:</span><span class="token string">'./dist'</span><span class="token punctuation">,</span>
 <span class="token literal-property property">host</span><span class="token operator">:</span><span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用命令行参数自动引入插件"><a href="#使用命令行参数自动引入插件" class="header-anchor">#</a> 使用命令行参数自动引入插件</h3> <ul><li>添加 --hot 参数后，devServer 会告诉 Webpack 自动引入 HotModuleReplacementPlugin ，而不需要我们手动引入。
另外常常也搭配 --open 来自动打开浏览器到页面。</li></ul> <p>package.json</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span><span class="token string">&quot;webapck-dev-server  --hot --open&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="热更新-webpack-dev-middleware"><a href="#热更新-webpack-dev-middleware" class="header-anchor">#</a> 热更新：webpack-dev-middleware</h2> <ul><li>WDM 将 webpack 输出的文件传输给服务器</li> <li>适用于灵活定制场景</li></ul> <p><img src="https://user-images.githubusercontent.com/33340988/110231061-6dbac500-7f50-11eb-971a-560221e03590.png" alt="image"></p> <h2 id="热更新原理分析"><a href="#热更新原理分析" class="header-anchor">#</a> 热更新原理分析</h2> <p><img src="https://user-images.githubusercontent.com/33340988/110231064-714e4c00-7f50-11eb-9407-4b282e640ac2.png" alt="image"></p> <p>文件指纹</p> <ul><li>打包后输出的文件名的后缀</li> <li>版本管理、浏览器缓存</li></ul> <p><img src="https://user-images.githubusercontent.com/33340988/110231068-77dcc380-7f50-11eb-989e-be7610b21277.png" alt="image"></p> <p>文件压缩</p> <h3 id="js-文件的压缩"><a href="#js-文件的压缩" class="header-anchor">#</a> JS 文件的压缩</h3> <ul><li>内置了 uglifyjs-webpack-plugin</li></ul> <h3 id="css-文件的压缩"><a href="#css-文件的压缩" class="header-anchor">#</a> CSS 文件的压缩</h3> <ul><li>使用 optimize-css-assets-webpack-plugin</li> <li>同时使用 cssnano</li></ul> <h3 id="html-文件的压缩"><a href="#html-文件的压缩" class="header-anchor">#</a> html 文件的压缩</h3> <ul><li>修改 html-webpack-plugin，设置压缩参数</li></ul> <h2 id="自动清理构建目录"><a href="#自动清理构建目录" class="header-anchor">#</a> 自动清理构建目录</h2> <ul><li>避免构建前每次都需要手动删除 dist</li> <li>clean-webpack-plugin （默认会删除 output 指定的输出目录）</li></ul> <h2 id="资源内联"><a href="#资源内联" class="header-anchor">#</a> 资源内联</h2> <h3 id="资源内联的意义"><a href="#资源内联的意义" class="header-anchor">#</a> 资源内联的意义</h3> <p>代码层面</p> <ul><li>页面框架的初始化搅拌</li> <li>上报相关打点</li> <li>css 内联避免页面闪动</li></ul> <p>请求层面</p> <ul><li>减少 HTTP 网络请求数（小图片或者字体内联 url-loader)</li></ul> <h3 id="html-和-js-内联"><a href="#html-和-js-内联" class="header-anchor">#</a> HTML 和 JS 内联</h3> <ul><li>raw-loader 内联 html</li> <li>raw-loader 内联 JS</li></ul> <h3 id="css-内联"><a href="#css-内联" class="header-anchor">#</a> CSS 内联</h3> <ol><li>借助 style-loader</li> <li>html-inline-css-webpack-plugin</li></ol> <h2 id="多页面打包"><a href="#多页面打包" class="header-anchor">#</a> 多页面打包</h2> <h3 id="多页面应用-mpa"><a href="#多页面应用-mpa" class="header-anchor">#</a> 多页面应用（MPA)</h3> <p>概念</p> <ul><li>每一次跳转的时候，后台服务器都会返回一个新的 html 文档，这种类型的网站也就是多页网站，也叫做多页应用。</li></ul> <p>优势</p> <ol><li>每个页面是解耦的</li> <li>对 SEO 更加友好</li></ol> <h3 id="多页面打包基本思路"><a href="#多页面打包基本思路" class="header-anchor">#</a> 多页面打包基本思路</h3> <ul><li>每个页面对应一个 entry，一个 html-webpack-plugin</li> <li>缺点：每次新增或者删除页面需要改 webpack 配置</li></ul> <p><img src="https://user-images.githubusercontent.com/33340988/110231075-7e6b3b00-7f50-11eb-9d98-b3f6b99a5554.png" alt="image"></p> <p>多页面打包通用方案</p> <ol><li>js 脚本动态获取 entry 和设置 html-webpack-plugin 数量</li> <li>利用 glob 库获取 entry <code>entry:glob.sync(path.join(__dirname,’./src/*/index.js’))</code></li></ol> <h2 id="提取页面公共资源"><a href="#提取页面公共资源" class="header-anchor">#</a> 提取页面公共资源</h2> <h3 id="基础库分离"><a href="#基础库分离" class="header-anchor">#</a> 基础库分离</h3> <ul><li>思路：将 react、react-dom 基础包通过 cdn 引入，不打入 bundle</li> <li>方法：使用 html-wenpack-externals-plugin</li> <li>利用 SplitChunksPlugin 进行公共脚本分离</li></ul> <h2 id="tree-shaking-摇树优化"><a href="#tree-shaking-摇树优化" class="header-anchor">#</a> tree shaking （摇树优化）</h2> <ul><li>概念：1 个模块可能有多个方法，只有其中的某个方法使用到了，则整个文件都会被打到 bundle 里面去，tree shaking 就是只把用到的方法打入 bundle ，没用到的方法会在 uglify 阶段被擦除掉。</li> <li>使用：webpack 默认支持 ，在 .babelrc 里设置 modules:false 即可。（ production mode 的情况下默认开启）</li> <li>要求：必须是 ES6 的语法，CJS 的方式不支持。</li></ul> <h3 id="dce-elimination"><a href="#dce-elimination" class="header-anchor">#</a> DCE（Elimination）</h3> <ul><li>代码不会被执行，不可到达</li> <li>代码只想的结果不会被用到</li> <li>代码只会影响死变量（只写不读）</li></ul> <h3 id="tree-shaking-原理"><a href="#tree-shaking-原理" class="header-anchor">#</a> Tree-shaking 原理</h3> <p>利用 ES6 模块的特点：</p> <ul><li>只能作为模块顶层的语句出现</li> <li>import 的模块名只能是字符串常量</li> <li>import binding 是 immutable 的</li></ul> <p>代码擦除：uglify 阶段删除无用代码</p> <h2 id="scopehoisting"><a href="#scopehoisting" class="header-anchor">#</a> ScopeHoisting</h2> <h3 id="webapck-构建"><a href="#webapck-构建" class="header-anchor">#</a> webapck 构建</h3> <p>现象</p> <ul><li>构建后会产生大量闭包包裹代码</li> <li>被 webpack 转换后的模块会带上一层包裹</li> <li>import 会被转换成 __webpack_require</li></ul> <p>会导致什么问题？</p> <ul><li>大量函数闭包包裹代码，导致体积增大（模块越多越明显）</li> <li>运行代码时创建的函数作用域变多，内存开销变大</li></ul> <h3 id="scope-hoisting-原理"><a href="#scope-hoisting-原理" class="header-anchor">#</a> scope hoisting 原理</h3> <ul><li>原理：将所有模块的代码按照引用顺序放在一个函数作用于里，然后适当的重命名一些变量以防止变量名冲突</li> <li>对比：通过 scopr hoisting 可以减少函数声明代码和内存开销</li></ul> <h3 id="scope-hoisting-使用"><a href="#scope-hoisting-使用" class="header-anchor">#</a> scope hoisting 使用</h3> <ul><li>webpack mode 为 production 默认开启</li> <li>必须是 ES6 语法，CJS 不支持</li></ul> <h2 id="代码分割和动态-import"><a href="#代码分割和动态-import" class="header-anchor">#</a> 代码分割和动态 import</h2> <h3 id="代码分割的意义"><a href="#代码分割的意义" class="header-anchor">#</a> 代码分割的意义</h3> <ul><li>对于大的 web 应用来讲，将所有代码都放在一个文件中先认识不够有效的，特别是当你的某些代码块是在某些特殊的时候再回呗使用到。webpack 又一个功能就是将你的代码库分割成 chunks （语块），当代码运行到需要它们的时候再进行加载。</li></ul> <p>适用的场景：</p> <ul><li>抽离相同代码到一个共享块</li> <li>脚本懒加载，使得初始下载的代码更小</li></ul> <h3 id="懒加载-js-脚本的方式"><a href="#懒加载-js-脚本的方式" class="header-anchor">#</a> 懒加载 JS 脚本的方式</h3> <ul><li>CommonJS: require.ensure</li> <li>ES6: 动态 import （目前还没有原生支持，需要 babel 转换）</li></ul> <p>如何使用动态 import ？</p> <ul><li>安装 babel 插件 @babel/plugin-syntax-dynamic-import</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//bable</span>

<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;plugins&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-syntax-dynamic-import&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><ul><li>将一个大的 JS 分割成多个 JS，动态加载。</li></ul> <h1 id="webpack-构建提速"><a href="#webpack-构建提速" class="header-anchor">#</a> webpack 构建提速</h1> <ul><li>https://mp.weixin.qq.com/s/ajIvJWyvjnWMYTxHjooErQ</li></ul> <p>96 秒 -&gt;40 秒 -&gt; 16 秒</p> <p>一方面，H 项目的 webpack 配置是一个典型的多入口类型，每次打包出来的代码包含了十几个子项目模块。但是一般的开发需求往往集中在一个子项目中去开发，所以只需要打包某个具体的子项目就满足了。</p> <p>另一方面，项目构建打包的大部分时间花费在了 loader 上面，其中主要是 babel-loader 和 eslint-loader，如果把 loader 编译的结果缓存下来应该能有效缩短构建时间。</p> <ul><li>动态入口</li> <li>cache-loader</li></ul> <h1 id="预设-presets"><a href="#预设-presets" class="header-anchor">#</a> 预设（Presets）</h1> <ul><li>preset 可以作为 Babel 插件的组合，甚至可以作为可以共享的 options 配置。</li></ul> <h3 id="官方-preset"><a href="#官方-preset" class="header-anchor">#</a> 官方 Preset</h3> <ul><li>@babel/preset-env</li> <li>@babel/preset-flow</li> <li>@babel/preset-react</li> <li>@babel/preset-typescript</li></ul> <p>编写一个 Preset</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/plugin-proposal-class-properties&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">loose</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/plugin-proposal-object-rest-spread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/exposir/personal-blog/edit/master/docs/post/webpack.md" target="_blank" rel="noopener noreferrer">编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">lastUpdate:</span> <span class="time">1/24/2022, 3:41:29 PM</span></div></footer> <div><div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/post/重学 Javascript（一）.html" class="prev">
        重学 Javascript（一）
      </a></span> <span class="next"><a href="/post/git 提交指北.html">
        git 提交指北
      </a>
      →
    </span></p></div> <div class="icp-footer"><p>Copyright© 2020-2022 卡颂</p> <a href="https://beian.miit.gov.cn/" target="_blank">京ICP备20028082号-1</a></div></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.dae46446.js" defer></script><script src="/assets/js/2.8d9d2f5c.js" defer></script><script src="/assets/js/37.8be78373.js" defer></script><script src="/assets/js/3.3fcef884.js" defer></script>
  </body>
</html>
